"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[76],{7511:(D,d,a)=>{a.d(d,{f:()=>o});var h=a(4438),y=a(5794);let o=(()=>{class u{toastr;constructor(n){this.toastr=n}success(n,v=null){this.toastr.clear(),this.toastr.success(n,v,{positionClass:"toast-bottom-right"})}error(n,v=null){this.toastr.clear(),this.toastr.error(n,v,{positionClass:"toast-bottom-right"})}static \u0275fac=function(v){return new(v||u)(h.KVO(y.tw))};static \u0275prov=h.jDH({token:u,factory:u.\u0275fac,providedIn:"root"})}return u})()},6546:(D,d,a)=>{a.d(d,{v:()=>b});var h=a(467),y=a(9724),o=a(8986);class u{type;value;salt;previousBalance;previousBalanceHash;hash;price;constructor(f,t,e,r,s,c,l){this.type=f,this.value=t,this.salt=e,this.previousBalance=r,this.previousBalanceHash=s,this.hash=c,this.price=l}}class S{balanceHash;balance;previousBalanceHash;hashes;prices;price_now;constructor(f,t,e,r,s,c){this.balanceHash=f,this.balance=t,this.previousBalanceHash=e,this.hashes=r,this.prices=s,this.price_now=c}toArray(){let f=[this.balanceHash,this.balance,this.previousBalanceHash];return f.push(...this.hashes,...this.prices,this.price_now),f}}var n=a(4438),v=a(8129),B=a(3465);let H=(()=>{class i{constructor(){}prove(t){return(0,h.A)(function*(){return window.witness(t)})()}verify(t,e,r){return(0,h.A)(function*(){return window.groth16Verify(t,e.toArray(),r)})()}static \u0275fac=function(e){return new(e||i)};static \u0275prov=n.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var V=a(4412);let P=(()=>{class i{verificationKey=new V.t(null);constructor(){this.initAssets()}initAssets(){fetch("./assets/verification_key.json").then(t=>t.json()).then(t=>{this.verificationKey.next(t)})}getVerificationKey(){if(!this.verificationKey.getValue())throw new Error("Verfiication key not loaded yet");return this.verificationKey.getValue()}static \u0275fac=function(e){return new(e||i)};static \u0275prov=n.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),b=(()=>{class i{contract;priceService;walletService;witnessService;assetsService;constructor(t,e,r,s,c){this.contract=t,this.priceService=e,this.walletService=r,this.witnessService=s,this.assetsService=c}prove(t){return(0,y.H)(this.internalProve(t))}internalProve(t){var e=this;return(0,h.A)(function*(){const r=e.walletService.getAddress(),s=yield e.contract.getTradeLen(),c=yield e.contract.getSignal(r,s-2),l=yield e.contract.getSignal(r,s-1),w=c.price,A=l.price,m=e.priceService.getBtcPriceValue(),p=yield e.contract.getProofLen(r);let g="639470893622803446635721399483204517617715645899470263648676575355455357367";0!==p&&(g=yield e.contract.getPrevBalanceHash(r,p-1));let K=new u([t.proofs[0].action,t.proofs[1].action],[t.proofs[0].amount,t.proofs[1].amount],[t.proofs[0].nonce,t.proofs[1].nonce],[t.usdBalance,t.btcBalance],g,[c.hash,l.hash],[o.A.removeDecimalDigitsNumber(w),o.A.removeDecimalDigitsNumber(A),o.A.removeDecimalDigitsNumber(m)]);const O=yield e.witnessService.prove(K);yield e.contract.addPeriodProof(O,yield e.contract.getCurrentBlockNumber(),BigInt(o.A.decimalDigitsNumber(o.A.removeDecimalDigitsNumber(m))))})()}verify(t,e){return(0,y.H)(this.internalVerify(t,e))}verifyAll(t,e){return(0,y.H)(this.internalVerifyAll(t,e))}internalVerifyAll(t,e){var r=this;return(0,h.A)(function*(){let s=!0;for(const c of e){let l=yield r.internalVerify(t,c);s=s&&l}return new Promise(c=>{c(s)})})()}internalVerify(t,e){var r=this;return(0,h.A)(function*(){const s=yield r.contract.getPeriodProofs(t,e),c=yield r.contract.getSignal(t,2*e),l=yield r.contract.getSignal(t,2*e+1),w=c.price,A=l.price,m=s.prices[0];let p="639470893622803446635721399483204517617715645899470263648676575355455357367";0!==e&&(p=(yield r.contract.getPeriodProofs(t,e-1)).newBalanceHash);const g=new S(s.newBalanceHash,s.y,p,[c.hash,l.hash],[o.A.removeDecimalDigitsNumber(w),o.A.removeDecimalDigitsNumber(A)],o.A.removeDecimalDigitsNumber(m));return r.witnessService.verify(r.assetsService.getVerificationKey(),g,s.proof)})()}static \u0275fac=function(e){return new(e||i)(n.KVO("SmartContractInterface"),n.KVO(v.d),n.KVO(B.F),n.KVO(H),n.KVO(P))};static \u0275prov=n.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})()}}]);