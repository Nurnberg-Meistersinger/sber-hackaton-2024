"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[76],{7511:(A,m,o)=>{o.d(m,{f:()=>a});var l=o(4438),y=o(5794);let a=(()=>{class u{toastr;constructor(n){this.toastr=n}success(n,v=null){this.toastr.clear(),this.toastr.success(n,v,{positionClass:"toast-bottom-right"})}error(n,v=null){this.toastr.clear(),this.toastr.error(n,v,{positionClass:"toast-bottom-right"})}static \u0275fac=function(v){return new(v||u)(l.KVO(y.tw))};static \u0275prov=l.jDH({token:u,factory:u.\u0275fac,providedIn:"root"})}return u})()},6546:(A,m,o)=>{o.d(m,{v:()=>N});var l=o(467),y=o(9724),a=o(8986);class u{type;value;salt;previousBalance;previousBalanceHash;hash;price;constructor(f,t,e,r,i,c,h){this.type=f,this.value=t,this.salt=e,this.previousBalance=r,this.previousBalanceHash=i,this.hash=c,this.price=h}}class S{balanceHash;balance;previousBalanceHash;hashes;prices;price_now;constructor(f,t,e,r,i,c){this.balanceHash=f,this.balance=t,this.previousBalanceHash=e,this.hashes=r,this.prices=i,this.price_now=c}toArray(){let f=[this.balanceHash,this.balance,this.previousBalanceHash];return f.push(...this.hashes,...this.prices,this.price_now),f}}var n=o(4438),v=o(8129),H=o(3465);let P=(()=>{class s{constructor(){}prove(t){return(0,l.A)(function*(){return window.witness(t)})()}verify(t,e,r){return(0,l.A)(function*(){return window.groth16Verify(t,e.toArray(),r)})()}static \u0275fac=function(e){return new(e||s)};static \u0275prov=n.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();var V=o(4412);let K=(()=>{class s{verificationKey=new V.t(null);constructor(){this.initAssets()}initAssets(){fetch("./assets/verification_key.json").then(t=>t.json()).then(t=>{this.verificationKey.next(t)})}getVerificationKey(){if(!this.verificationKey.getValue())throw new Error("Verfiication key not loaded yet");return this.verificationKey.getValue()}static \u0275fac=function(e){return new(e||s)};static \u0275prov=n.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})(),N=(()=>{class s{contract;priceService;walletService;witnessService;assetsService;constructor(t,e,r,i,c){this.contract=t,this.priceService=e,this.walletService=r,this.witnessService=i,this.assetsService=c}prove(t){return(0,y.H)(this.internalProve(t))}internalProve(t){var e=this;return(0,l.A)(function*(){const r=e.walletService.getAddress(),i=yield e.contract.getTradeLen(),c=yield e.contract.getSignal(r,i-2),h=yield e.contract.getSignal(r,i-1),w=a.A.floorNumber(t.proofs[0].price),b=a.A.floorNumber(t.proofs[1].price),p=yield e.contract.getCurrentBlockNumber(),g=a.A.floorNumber(e.priceService.getBtcPriceByBlockNumber(p)),d=yield e.contract.getProofLen(r);let B="639470893622803446635721399483204517617715645899470263648676575355455357367";0!==d&&(B=yield e.contract.getPrevBalanceHash(r,d-1));let D=new u([t.proofs[0].action,t.proofs[1].action],[t.proofs[0].amount,t.proofs[1].amount],[t.proofs[0].nonce,t.proofs[1].nonce],[t.usdBalance,t.btcBalance],B,[c.hash,h.hash],[a.A.removeDecimalDigitsNumber(w),a.A.removeDecimalDigitsNumber(b),g]);const O=yield e.witnessService.prove(D);yield e.contract.addPeriodProof(O,p)})()}verify(t,e){return(0,y.H)(this.internalVerify(t,e))}verifyAll(t,e){return(0,y.H)(this.internalVerifyAll(t,e))}internalVerifyAll(t,e){var r=this;return(0,l.A)(function*(){let i=!0;for(const c of e){let h=yield r.internalVerify(t,c);i=i&&h}return new Promise(c=>{c(i)})})()}internalVerify(t,e){var r=this;return(0,l.A)(function*(){const i=yield r.contract.getPeriodProofs(t,e),c=yield r.contract.getSignal(t,2*e),h=yield r.contract.getSignal(t,2*e+1),w=a.A.bigIntToFloorNumber(c.price),b=a.A.bigIntToFloorNumber(h.price),p=a.A.floorNumber(r.priceService.getBtcPriceByBlockNumber(i.blockNumber));let g="639470893622803446635721399483204517617715645899470263648676575355455357367";0!==e&&(g=(yield r.contract.getPeriodProofs(t,e-1)).newBalanceHash);const d=new S(i.newBalanceHash,i.y,g,[c.hash,h.hash],[w,b],p);return r.witnessService.verify(r.assetsService.getVerificationKey(),d,i.proof)})()}static \u0275fac=function(e){return new(e||s)(n.KVO("SmartContractInterface"),n.KVO(v.d),n.KVO(H.F),n.KVO(P),n.KVO(K))};static \u0275prov=n.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})()}}]);